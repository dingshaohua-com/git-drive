<!doctype html>
<html>
  <head>
    <title>Scalar API Reference</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  </head>
  <body>
    <!-- Need a Custom Header? Check out this example https://codepen.io/scalarorg/pen/VwOXqam -->
    <!-- <script id="api-reference" data-url="/api/doc"></script> -->
    <script>
      // ä¿å­˜åŸå§‹çš„ fetch å‡½æ•°
      const originalFetch = window.fetch;

      // é‡å†™ fetch
      window.fetch = async function (...args) {
        let [resource, config] = args;

        // console.log('ğŸ” æ‹¦æˆªåˆ°çš„è¯·æ±‚:', {
        //   url: resource,
        //   method: config?.method || 'GET',
        //   headers: config?.headers,
        //   body: config?.body,
        // });

        // // ä½ å¯ä»¥åœ¨è¿™é‡Œä¿®æ”¹è¯·æ±‚å‚æ•°
        // // ä¾‹å¦‚ï¼šæ·»åŠ  token åˆ° headers
        // if (!config) config = {};
        // if (!config.headers) config.headers = {};
        // config.headers['Authorization'] = 'Bearer your-token';

        try {
          const response = await originalFetch(resource, config);

          // ä½ ä¹Ÿå¯ä»¥åœ¨è¿™é‡Œå¤„ç†å“åº”

          // console.log('âœ… å“åº”:', response);

          // å¦‚æœä½ æƒ³è¯»å–å“åº”ä½“ï¼Œå¯ä»¥å…‹éš†ä¸€ä»½å†è¯»å–
          const clonedResponse = response.clone();
          const bodyText = await clonedResponse.text();
          // console.log('ğŸ“¦ å“åº”ä½“:', bodyText);
          if (resource.indexOf('/api/doc') > -1) {
            setTimeout(() => {
              rewriteDom();
            }, 100);
          }
          return response;
        } catch (error) {
          // console.error('âŒ fetch å‡ºé”™:', error);
          throw error;
        }
      };

      function rewriteDom() {
        const sectionContent = document.querySelectorAll('.section-content');
        sectionContent.forEach((item) => {
          const reqBodyTitle = item.querySelector('.request-body-title');
          if (reqBodyTitle) {
            const text = document.createElement('span'); // æ¨èç”¨ spanï¼ŒText ä¸æ˜¯åˆæ³•æ ‡ç­¾
            text.textContent = 'è¯·æ±‚ä½“';

            const targetNode = reqBodyTitle.childNodes[1];
            if (targetNode) {
              reqBodyTitle.replaceChild(text, targetNode);
            } else {
              console.warn('ç›®æ ‡èŠ‚ç‚¹ä¸å­˜åœ¨');
            }
          }

          // if (reqBodyTitle) reqBodyTitle.innerHTML = 'è¯·æ±‚ä½“';
        });
        const serverRef = document.querySelector('.scalar-reference-intro-server');
        if (serverRef) {
          serverRef.querySelector('label').innerText = 'æœåŠ¡';
        }
      }

      function loadScriptOnce(txt) {
        const s = document.createElement('script');
        s.innerText = txt;
        document.body.appendChild(s);
      }

      const locale = {
        'Client Libraries': 'å®¢æˆ·ç«¯ ç±»å‹',
        // 'Search':'æœç´¢',
        'â†‘â†“ Navigate': 'â†‘â†“ å¯¼èˆª',
        'â Select': 'â é€‰æ‹©',
        'Download OpenAPI Document': 'ä¸‹è½½ OpenAPI æ–‡æ¡£',
        Models: 'æ¨¡å‹',
        'Open API Client': 'æ‰“å¼€å®¢æˆ·ç«¯',
        Responses: 'å“åº”',
        Headers: 'è¯·æ±‚å¤´',
        Operations: 'æ¥å£åˆ—è¡¨',
        // required: 'å¿…é¡»'
      };

      const main = async () => {
        let res = await fetch('https://cdn.jsdelivr.net/npm/@scalar/api-reference').then((res) => res.text());
        Object.keys(locale).forEach((item) => {
          res = res.replaceAll(item, locale[item]);
        });
        loadScriptOnce(res);
      };
      localStorage.setItem('scalar-reference-selected-client-v2', 'js/axios');

      // åŠ¨æ€åˆ›å»ºscript æ ‡ç­¾ 1

      const scriptNode = document.createElement('script');
      scriptNode.setAttribute('data-url', location.origin + '/api/doc');
      scriptNode.id = 'api-reference';
      document.body.appendChild(scriptNode);

      // åŠ¨æ€åˆ›å»ºscript æ ‡ç­¾ 2
      main();
    </script>
  </body>
</html>
